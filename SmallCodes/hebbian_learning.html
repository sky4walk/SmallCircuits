<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Hebbian Learning Demo</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: 'Segoe UI', sans-serif;
    background: #0f1117;
    color: #e0e0e0;
    min-height: 100vh;
    padding: 24px;
  }
  h1 {
    font-size: 1.4rem;
    font-weight: 600;
    color: #a78bfa;
    margin-bottom: 4px;
  }
  .subtitle {
    font-size: 0.85rem;
    color: #6b7280;
    margin-bottom: 24px;
  }
  .layout {
    display: grid;
    grid-template-columns: 300px 1fr;
    gap: 20px;
    max-width: 1100px;
    margin: 0 auto;
  }
  .panel {
    background: #1a1d27;
    border: 1px solid #2d2f3e;
    border-radius: 12px;
    padding: 20px;
  }
  .panel h2 {
    font-size: 0.85rem;
    font-weight: 600;
    color: #a78bfa;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    margin-bottom: 16px;
  }
  label {
    display: block;
    font-size: 0.8rem;
    color: #9ca3af;
    margin-bottom: 4px;
    margin-top: 14px;
  }
  input[type=range] {
    width: 100%;
    accent-color: #a78bfa;
  }
  .val {
    float: right;
    color: #a78bfa;
    font-weight: 600;
  }
  .scenario-btn {
    display: block;
    width: 100%;
    padding: 9px 12px;
    margin-bottom: 8px;
    background: #23263a;
    border: 1px solid #3a3d52;
    border-radius: 8px;
    color: #d1d5db;
    font-size: 0.8rem;
    cursor: pointer;
    text-align: left;
    transition: all 0.15s;
  }
  .scenario-btn:hover, .scenario-btn.active {
    background: #2e2060;
    border-color: #a78bfa;
    color: #a78bfa;
  }
  .scenario-btn small {
    display: block;
    color: #6b7280;
    font-size: 0.72rem;
    margin-top: 2px;
  }
  .btn-row {
    display: flex;
    gap: 8px;
    margin-top: 16px;
  }
  button.primary {
    flex: 1;
    padding: 10px;
    background: #6d28d9;
    border: none;
    border-radius: 8px;
    color: white;
    font-size: 0.82rem;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.15s;
  }
  button.primary:hover { background: #7c3aed; }
  button.secondary {
    flex: 1;
    padding: 10px;
    background: #23263a;
    border: 1px solid #3a3d52;
    border-radius: 8px;
    color: #9ca3af;
    font-size: 0.82rem;
    cursor: pointer;
    transition: all 0.15s;
  }
  button.secondary:hover { background: #2d3050; color: #d1d5db; }
  canvas { display: block; }
  .charts {
    display: grid;
    grid-template-rows: 1fr 1fr;
    gap: 16px;
  }
  .chart-box {
    background: #1a1d27;
    border: 1px solid #2d2f3e;
    border-radius: 12px;
    padding: 16px;
    position: relative;
  }
  .chart-box h3 {
    font-size: 0.78rem;
    color: #6b7280;
    text-transform: uppercase;
    letter-spacing: 0.07em;
    margin-bottom: 10px;
  }
  .formula {
    background: #0d0f18;
    border: 1px solid #2d2f3e;
    border-radius: 8px;
    padding: 10px 14px;
    font-family: 'Courier New', monospace;
    font-size: 0.8rem;
    color: #34d399;
    margin-top: 10px;
    margin-bottom: 4px;
  }
  .stats {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    margin-top: 12px;
  }
  .stat {
    background: #0d0f18;
    border-radius: 8px;
    padding: 8px 10px;
    font-size: 0.75rem;
  }
  .stat-label { color: #6b7280; }
  .stat-value { color: #a78bfa; font-weight: 600; font-size: 0.9rem; margin-top: 2px; }
  .oja-toggle {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: 14px;
    font-size: 0.8rem;
    color: #9ca3af;
    cursor: pointer;
  }
  input[type=checkbox] { accent-color: #a78bfa; width: 15px; height: 15px; cursor: pointer; }
</style>
</head>
<body>

<div style="max-width:1100px;margin:0 auto 16px auto">
  <h1>ğŸ§  Hebbian Learning â€“ Interaktive Demo</h1>
  <div class="subtitle">Beobachte, wie synaptische Gewichte wachsen wenn Neuronen zusammen feuern</div>
</div>

<div class="layout">
  <!-- LEFT PANEL -->
  <div>
    <div class="panel" style="margin-bottom:16px">
      <h2>Parameter</h2>

      <label>Lernrate Î· <span class="val" id="lr-val">0.05</span></label>
      <input type="range" id="lr" min="0.001" max="0.2" step="0.001" value="0.05">

      <label>Korrelation Aâ†”B <span class="val" id="corr-val">0.8</span></label>
      <input type="range" id="corr" min="-1" max="1" step="0.05" value="0.8">

      <label>Rauschen <span class="val" id="noise-val">0.1</span></label>
      <input type="range" id="noise" min="0" max="0.5" step="0.01" value="0.1">

      <label>Trainingsschritte <span class="val" id="steps-val">200</span></label>
      <input type="range" id="steps" min="20" max="500" step="10" value="200">

      <label class="oja-toggle">
        <input type="checkbox" id="oja-toggle">
        Oja-Regel (mit Decay) verwenden
      </label>

      <div class="formula" id="formula">Î”w = Î· Â· xáµ¢ Â· xâ±¼</div>

      <div class="btn-row">
        <button class="primary" onclick="runSimulation()">â–¶ Simulieren</button>
        <button class="secondary" onclick="resetAll()">â†º Reset</button>
      </div>
    </div>

    <div class="panel">
      <h2>Szenarien</h2>
      <button class="scenario-btn active" id="s0" onclick="loadScenario(0)">
        ğŸ• Hund & Wort
        <small>Hohe Korrelation â†’ starkes Lernen</small>
      </button>
      <button class="scenario-btn" id="s1" onclick="loadScenario(1)">
        â„ï¸ ZufÃ¤llige Inputs
        <small>Keine Korrelation â†’ kaum Lernen</small>
      </button>
      <button class="scenario-btn" id="s2" onclick="loadScenario(2)">
        âš¡ Hemmung
        <small>Negative Korrelation â†’ Gewicht sinkt</small>
      </button>
      <button class="scenario-btn" id="s3" onclick="loadScenario(3)">
        ğŸŒŠ Oja-Stabilisierung
        <small>Gewicht konvergiert stabil</small>
      </button>
    </div>
  </div>

  <!-- RIGHT CHARTS -->
  <div class="charts">
    <div class="chart-box">
      <h3>Gewichtsentwicklung Ã¼ber Zeit</h3>
      <canvas id="weightChart"></canvas>
      <div class="stats">
        <div class="stat">
          <div class="stat-label">Startgewicht</div>
          <div class="stat-value" id="w-start">0.10</div>
        </div>
        <div class="stat">
          <div class="stat-label">Endgewicht</div>
          <div class="stat-value" id="w-end">â€”</div>
        </div>
        <div class="stat">
          <div class="stat-label">Ã„nderung</div>
          <div class="stat-value" id="w-delta">â€”</div>
        </div>
        <div class="stat">
          <div class="stat-label">Ã˜ Î”w pro Schritt</div>
          <div class="stat-value" id="w-avg">â€”</div>
        </div>
      </div>
    </div>

    <div class="chart-box">
      <h3>Neuronale Aktivierungen (xáµ¢ Â· xâ±¼) â€“ Korrelationsstreuung</h3>
      <canvas id="scatterChart"></canvas>
    </div>
  </div>
</div>

<script>
// â”€â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let weightHistory = [];
let scatterData = [];
let animFrame = null;

// â”€â”€â”€ Params â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getParams() {
  return {
    lr: parseFloat(document.getElementById('lr').value),
    corr: parseFloat(document.getElementById('corr').value),
    noise: parseFloat(document.getElementById('noise').value),
    steps: parseInt(document.getElementById('steps').value),
    oja: document.getElementById('oja-toggle').checked
  };
}

// â”€â”€â”€ Slider live update â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
['lr','corr','noise','steps'].forEach(id => {
  document.getElementById(id).addEventListener('input', () => {
    document.getElementById(id+'-val').textContent =
      parseFloat(document.getElementById(id).value).toFixed(
        id==='steps' ? 0 : id==='lr' ? 3 : 2
      );
  });
});

document.getElementById('oja-toggle').addEventListener('change', () => {
  const oja = document.getElementById('oja-toggle').checked;
  document.getElementById('formula').textContent =
    oja ? 'Î”w = Î· Â· xáµ¢ Â· xâ±¼  âˆ’  Î· Â· xâ±¼Â² Â· w' : 'Î”w = Î· Â· xáµ¢ Â· xâ±¼';
});

// â”€â”€â”€ Scenarios â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const scenarios = [
  { lr: 0.05, corr: 0.8,  noise: 0.1,  steps: 200, oja: false },
  { lr: 0.05, corr: 0.0,  noise: 0.3,  steps: 200, oja: false },
  { lr: 0.05, corr: -0.8, noise: 0.1,  steps: 200, oja: false },
  { lr: 0.08, corr: 0.9,  noise: 0.05, steps: 300, oja: true  },
];

function loadScenario(i) {
  document.querySelectorAll('.scenario-btn').forEach((b,j) =>
    b.classList.toggle('active', i===j));
  const s = scenarios[i];
  document.getElementById('lr').value    = s.lr;
  document.getElementById('corr').value  = s.corr;
  document.getElementById('noise').value = s.noise;
  document.getElementById('steps').value = s.steps;
  document.getElementById('oja-toggle').checked = s.oja;
  document.getElementById('lr-val').textContent    = s.lr.toFixed(3);
  document.getElementById('corr-val').textContent  = s.corr.toFixed(2);
  document.getElementById('noise-val').textContent = s.noise.toFixed(2);
  document.getElementById('steps-val').textContent = s.steps;
  document.getElementById('formula').textContent =
    s.oja ? 'Î”w = Î· Â· xáµ¢ Â· xâ±¼  âˆ’  Î· Â· xâ±¼Â² Â· w' : 'Î”w = Î· Â· xáµ¢ Â· xâ±¼';
  runSimulation();
}

// â”€â”€â”€ Simulation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function generateCorrelatedPair(corr, noise) {
  // Box-Muller
  const u1 = Math.random(), u2 = Math.random();
  const z0 = Math.sqrt(-2*Math.log(u1)) * Math.cos(2*Math.PI*u2);
  const z1 = Math.sqrt(-2*Math.log(u1)) * Math.sin(2*Math.PI*u2);
  const xi = Math.max(0, 0.5 + 0.3*z0 + noise * (Math.random()-0.5));
  const xj = Math.max(0, 0.5 + 0.3*(corr*z0 + Math.sqrt(1-corr*corr)*z1) + noise*(Math.random()-0.5));
  return [xi, xj];
}

function runSimulation() {
  const p = getParams();
  weightHistory = [];
  scatterData = [];
  let w = 0.1;

  for (let t = 0; t < p.steps; t++) {
    const [xi, xj] = generateCorrelatedPair(p.corr, p.noise);
    let dw = p.lr * xi * xj;
    if (p.oja) dw -= p.lr * xj * xj * w;
    w += dw;
    weightHistory.push(w);
    if (t < 120) scatterData.push([xi, xj]);
  }

  updateStats(weightHistory);
  drawWeightChart();
  drawScatter();
}

function updateStats(wh) {
  const ws = wh[0].toFixed(3);
  const we = wh[wh.length-1].toFixed(3);
  const delta = (wh[wh.length-1] - 0.1).toFixed(3);
  const avg = (wh.reduce((a,b,i,arr) => i===0?0:a+Math.abs(b-arr[i-1]),0)/(wh.length-1)).toFixed(4);
  document.getElementById('w-start').textContent = '0.100';
  document.getElementById('w-end').textContent = we;
  document.getElementById('w-delta').textContent = (delta >= 0 ? '+' : '') + delta;
  document.getElementById('w-avg').textContent = avg;
}

function resetAll() {
  weightHistory = [];
  scatterData = [];
  drawWeightChart();
  drawScatter();
  document.getElementById('w-end').textContent = 'â€”';
  document.getElementById('w-delta').textContent = 'â€”';
  document.getElementById('w-avg').textContent = 'â€”';
}

// â”€â”€â”€ Drawing â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setupCanvas(id) {
  const box = document.getElementById(id).parentElement;
  const c = document.getElementById(id);
  const W = box.clientWidth - 32;
  const H = Math.min(220, window.innerHeight * 0.25);
  c.width = W; c.height = H;
  return { c, ctx: c.getContext('2d'), W, H };
}

function drawWeightChart() {
  const {c, ctx, W, H} = setupCanvas('weightChart');
  ctx.clearRect(0,0,W,H);

  if (weightHistory.length === 0) {
    ctx.fillStyle = '#4b5563';
    ctx.font = '13px Segoe UI';
    ctx.textAlign = 'center';
    ctx.fillText('Klicke "Simulieren" um zu starten', W/2, H/2);
    return;
  }

  const pad = { t: 10, r: 20, b: 30, l: 45 };
  const cW = W - pad.l - pad.r;
  const cH = H - pad.t - pad.b;

  const minW = Math.min(...weightHistory) * 0.95;
  const maxW = Math.max(...weightHistory) * 1.05;
  const range = maxW - minW || 0.01;

  // Grid
  ctx.strokeStyle = '#1f2235';
  ctx.lineWidth = 1;
  for (let i = 0; i <= 4; i++) {
    const y = pad.t + (i/4) * cH;
    ctx.beginPath(); ctx.moveTo(pad.l, y); ctx.lineTo(pad.l+cW, y); ctx.stroke();
    const val = maxW - (i/4)*range;
    ctx.fillStyle = '#4b5563';
    ctx.font = '10px Segoe UI';
    ctx.textAlign = 'right';
    ctx.fillText(val.toFixed(2), pad.l-4, y+3);
  }

  // X axis labels
  ctx.fillStyle = '#4b5563';
  ctx.font = '10px Segoe UI';
  ctx.textAlign = 'center';
  for (let i = 0; i <= 4; i++) {
    const x = pad.l + (i/4)*cW;
    const step = Math.round((i/4)*(weightHistory.length-1));
    ctx.fillText(step, x, H-8);
  }

  // Zero line
  if (minW < 0 && maxW > 0) {
    const zy = pad.t + ((maxW)/(range))*cH;
    ctx.strokeStyle = '#374151';
    ctx.setLineDash([4,4]);
    ctx.beginPath(); ctx.moveTo(pad.l, zy); ctx.lineTo(pad.l+cW, zy); ctx.stroke();
    ctx.setLineDash([]);
  }

  // Gradient fill
  const grad = ctx.createLinearGradient(0, pad.t, 0, pad.t+cH);
  grad.addColorStop(0, 'rgba(167,139,250,0.3)');
  grad.addColorStop(1, 'rgba(167,139,250,0.02)');

  ctx.beginPath();
  weightHistory.forEach((w, i) => {
    const x = pad.l + (i/(weightHistory.length-1))*cW;
    const y = pad.t + ((maxW - w)/range)*cH;
    i === 0 ? ctx.moveTo(x,y) : ctx.lineTo(x,y);
  });
  ctx.lineTo(pad.l+cW, pad.t+cH);
  ctx.lineTo(pad.l, pad.t+cH);
  ctx.closePath();
  ctx.fillStyle = grad;
  ctx.fill();

  // Line
  ctx.beginPath();
  ctx.strokeStyle = '#a78bfa';
  ctx.lineWidth = 2;
  weightHistory.forEach((w, i) => {
    const x = pad.l + (i/(weightHistory.length-1))*cW;
    const y = pad.t + ((maxW - w)/range)*cH;
    i === 0 ? ctx.moveTo(x,y) : ctx.lineTo(x,y);
  });
  ctx.stroke();

  // Final dot
  const lx = pad.l + cW;
  const ly = pad.t + ((maxW - weightHistory[weightHistory.length-1])/range)*cH;
  ctx.beginPath();
  ctx.arc(lx, ly, 4, 0, Math.PI*2);
  ctx.fillStyle = '#a78bfa';
  ctx.fill();

  // Axis labels
  ctx.fillStyle = '#6b7280';
  ctx.font = '10px Segoe UI';
  ctx.textAlign = 'center';
  ctx.fillText('Trainingsschritt', pad.l + cW/2, H-1);
}

function drawScatter() {
  const {c, ctx, W, H} = setupCanvas('scatterChart');
  ctx.clearRect(0,0,W,H);

  if (scatterData.length === 0) {
    ctx.fillStyle = '#4b5563';
    ctx.font = '13px Segoe UI';
    ctx.textAlign = 'center';
    ctx.fillText('Klicke "Simulieren" um zu starten', W/2, H/2);
    return;
  }

  const pad = { t: 10, r: 20, b: 30, l: 40 };
  const cW = W - pad.l - pad.r;
  const cH = H - pad.t - pad.b;

  // Grid
  ctx.strokeStyle = '#1f2235';
  ctx.lineWidth = 1;
  for (let i = 0; i <= 4; i++) {
    const y = pad.t + (i/4)*cH;
    ctx.beginPath(); ctx.moveTo(pad.l, y); ctx.lineTo(pad.l+cW, y); ctx.stroke();
    ctx.fillStyle = '#4b5563';
    ctx.font = '10px Segoe UI';
    ctx.textAlign = 'right';
    ctx.fillText((1-i/4).toFixed(1), pad.l-4, y+3);
  }
  for (let i = 0; i <= 4; i++) {
    const x = pad.l + (i/4)*cW;
    ctx.beginPath(); ctx.moveTo(x, pad.t); ctx.lineTo(x, pad.t+cH); ctx.stroke();
    ctx.fillStyle = '#4b5563';
    ctx.font = '10px Segoe UI';
    ctx.textAlign = 'center';
    ctx.fillText((i/4).toFixed(1), x, H-8);
  }

  // Points â€“ color by product xáµ¢*xâ±¼
  scatterData.forEach(([xi, xj], idx) => {
    const x = pad.l + xi * cW;
    const y = pad.t + (1 - xj) * cH;
    const product = xi * xj;
    const intensity = Math.min(1, product * 2);
    const r = Math.round(167 * intensity + 75 * (1-intensity));
    const g = Math.round(139 * intensity + 85 * (1-intensity));
    const b = Math.round(250 * intensity + 107 * (1-intensity));
    ctx.beginPath();
    ctx.arc(x, y, 3, 0, Math.PI*2);
    ctx.fillStyle = `rgba(${r},${g},${b},0.7)`;
    ctx.fill();
  });

  // Axis labels
  ctx.fillStyle = '#6b7280';
  ctx.font = '10px Segoe UI';
  ctx.textAlign = 'center';
  ctx.fillText('Aktivierung Neuron A (xáµ¢)', pad.l+cW/2, H-1);

  ctx.save();
  ctx.translate(10, pad.t+cH/2);
  ctx.rotate(-Math.PI/2);
  ctx.textAlign = 'center';
  ctx.fillText('Aktivierung Neuron B (xâ±¼)', 0, 0);
  ctx.restore();

  // Correlation annotation
  const p = getParams();
  ctx.fillStyle = '#a78bfa';
  ctx.font = '11px Segoe UI';
  ctx.textAlign = 'right';
  ctx.fillText(`Ï = ${p.corr.toFixed(2)}`, W-pad.r, pad.t+14);
}

// â”€â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.addEventListener('resize', () => {
  if (weightHistory.length) { drawWeightChart(); drawScatter(); }
});

runSimulation();
</script>
</body>
</html>
